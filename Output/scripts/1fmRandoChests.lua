-------------------------------------------
------ Kingdom Hearts 1 FM Randomizer -----
------              by Gicu           -----
-------------------------------------------

LUAGUI_NAME = "1fmRandoChests"
LUAGUI_AUTH = "Gicu"
LUAGUI_DESC = "Kingdom Hearts 1FM Randomizer Chests"

canExecute = false
chests = {[0] = 16, [40] = 128, [42] = 2496, [44] = 3008, [46] = 128, [48] = 2432, [50] = 62, [52] = 2288, [54] = 2672, [58] = 2640, [60] = 448, [62] = 640, [64] = 4064, [66] = 2720, [68] = 2000, [70] = 48, [72] = 3376, [80] = 2464, [176] = 128, [178] = 2672, [180] = 1824, [182] = 2464, [184] = 848, [186] = 48, [188] = 2672, [190] = 2800, [192] = 32, [200] = 3376, [202] = 96, [204] = 1680, [206] = 2272, [208] = 3376, [210] = 2544, [212] = 1072, [214] = 32, [216] = 2672, [220] = 4080, [222] = 78, [224] = 32, [226] = 94, [228] = 2272, [244] = 2880, [246] = 110, [248] = 656, [250] = 4080, [252] = 4080, [256] = 2864, [258] = 1856, [260] = 3376, [264] = 512, [266] = 752, [268] = 126, [270] = 992, [272] = 4080, [274] = 2672, [276] = 2304, [278] = 2080, [280] = 4080, [282] = 3808, [284] = 1024, [334] = 2304, [336] = 2272, [338] = 2112, [340] = 2288, [394] = 4064, [396] = 2288, [398] = 2288, [400] = 2432, [402] = 142, [404] = 2672, [406] = 158, [408] = 174, [410] = 2016, [412] = 2944, [414] = 1936, [416] = 1584, [418] = 3376, [420] = 3376, [422] = 2960, [424] = 144, [426] = 1376, [428] = 2832, [430] = 32, [432] = 4064, [434] = 1360, [436] = 112, [438] = 4080, [440] = 96, [442] = 2896, [444] = 384, [446] = 2896, [448] = 528, [450] = 2464, [452] = 3568, [454] = 190, [456] = 64, [458] = 2416, [460] = 2464, [462] = 4064, [464] = 2272, [466] = 32, [606] = 2816, [608] = 2464, [610] = 2464, [612] = 2288, [614] = 2432, [616] = 2272, [618] = 2448, [620] = 3808, [622] = 64, [624] = 1952, [626] = 1600, [628] = 1008, [630] = 1776, [632] = 2448, [634] = 2784, [656] = 4064, [658] = 128, [660] = 4080, [662] = 3808, [666] = 2288, [668] = 2288, [670] = 608, [672] = 128, [674] = 1392, [676] = 2464, [484] = 4064, [486] = 16, [488] = 206, [490] = 32, [694] = 2672, [696] = 64, [698] = 64, [700] = 1840, [702] = 48, [710] = 64, [712] = 4064, [724] = 2272, [726] = 2816, [728] = 1712, [730] = 3760, [732] = 2288, [746] = 1728, [748] = 2304, [750] = 2464, [752] = 464, [1018] = 736, [754] = 64, [756] = 624, [758] = 144, [760] = 2432, [762] = 222, [764] = 3376, [766] = 2272, [806] = 2672, [808] = 2464, [810] = 48, [812] = 2672, [814] = 128, [816] = 2656, [818] = 2272, [820] = 112, [822] = 3808, [824] = 16, [826] = 4064, [828] = 2288, [830] = 2272, [832] = 2912, [834] = 64, [836] = 2432, [838] = 2848, [840] = 2672, [842] = 2816, [844] = 688, [854] = 128, [856] = 48, [858] = 3808, [860] = 2432, [862] = 1520, [864] = 32, [866] = 2464, [868] = 2464, [870] = 2304, [872] = 48, [874] = 2288, [876] = 2448, [878] = 622, [894] = 2896, [896] = 4080, [898] = 2272, [902] = 16, [904] = 2288, [906] = 4080, [908] = 16, [910] = 48, [912] = 2128, [914] = 2432, [916] = 2672, [918] = 96, [920] = 64, [922] = 32, [924] = 128, [926] = 2608, [928] = 2848, [930] = 672, [932] = 2272, [934] = 1696, [936] = 3056, [938] = 638, [940] = 2432, [942] = 32, [944] = 3024, [946] = 96, [948] = 928, [950] = 3696, [952] = 16, [954] = 128}
chests_written = false

function randomize_chests()
    chest_table_address = {0x529A60, 0x528D60}
    for offset,chest_short in pairs(chests) do
        WriteShort(chest_table_address[game_version] + offset, chest_short)
    end
end

function _OnInit()
    IsEpicGLVersion  = 0x3A2B86
    IsSteamGLVersion = 0x3A29A6
    if GAME_ID == 0xAF71841E and ENGINE_TYPE == "BACKEND" then
        if ReadByte(IsEpicGLVersion) == 0xF0 then
            ConsolePrint("Epic Version Detected")
            game_version = 1
            canExecute = true
        end
        if ReadByte(IsSteamGLVersion) == 0xF0 then
            ConsolePrint("Steam Version Detected")
            game_version = 2
            canExecute = true
        end
    end
end

function _OnFrame()
    if canExecute then
        if chests[0] ~= nil and not chests_written then
            randomize_chests()
        end
    end
end