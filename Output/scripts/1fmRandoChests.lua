-------------------------------------------
------ Kingdom Hearts 1 FM Randomizer -----
------              by Gicu           -----
-------------------------------------------

LUAGUI_NAME = "1fmRandoChests"
LUAGUI_AUTH = "Gicu"
LUAGUI_DESC = "Kingdom Hearts 1FM Randomizer Chests"

canExecute = false
chests = {[0] = 16, [40] = 2896, [42] = 2416, [44] = 1088, [46] = 2672, [48] = 880, [50] = 2064, [52] = 2672, [54] = 128, [58] = 2464, [60] = 96, [62] = 2976, [64] = 3808, [66] = 2464, [68] = 32, [70] = 3808, [72] = 128, [80] = 62, [176] = 1024, [178] = 144, [180] = 96, [182] = 32, [184] = 544, [186] = 2864, [188] = 2640, [190] = 1360, [192] = 2848, [200] = 1584, [202] = 592, [204] = 32, [206] = 2672, [208] = 464, [210] = 128, [212] = 2432, [214] = 48, [216] = 96, [220] = 2480, [222] = 2672, [224] = 2864, [226] = 2432, [228] = 2464, [244] = 2448, [246] = 16, [248] = 2304, [250] = 1680, [252] = 2272, [256] = 3808, [258] = 78, [260] = 2816, [264] = 2464, [266] = 2816, [268] = 128, [270] = 1040, [272] = 1792, [274] = 2976, [276] = 112, [278] = 144, [280] = 2800, [282] = 3376, [284] = 3808, [334] = 2672, [336] = 2432, [338] = 2672, [340] = 32, [394] = 2672, [396] = 16, [398] = 128, [400] = 320, [402] = 96, [404] = 16, [406] = 128, [408] = 64, [410] = 3472, [412] = 2944, [414] = 1632, [416] = 128, [418] = 16, [420] = 992, [422] = 64, [424] = 1712, [426] = 512, [428] = 688, [430] = 2448, [432] = 2672, [434] = 2672, [436] = 64, [438] = 96, [440] = 2272, [442] = 2448, [444] = 2672, [446] = 1104, [448] = 2544, [450] = 2288, [452] = 64, [454] = 16, [456] = 128, [458] = 2288, [460] = 3808, [462] = 3360, [464] = 3376, [466] = 2672, [606] = 64, [608] = 16, [610] = 2672, [612] = 2752, [614] = 32, [616] = 94, [618] = 2304, [620] = 2272, [622] = 608, [624] = 736, [626] = 32, [628] = 3728, [630] = 3808, [632] = 3808, [634] = 2432, [656] = 16, [658] = 2448, [660] = 110, [662] = 2272, [666] = 2880, [668] = 2672, [670] = 2464, [672] = 3040, [674] = 112, [676] = 816, [484] = 2592, [486] = 32, [488] = 3696, [490] = 16, [694] = 16, [696] = 1136, [698] = 2448, [700] = 2288, [702] = 528, [710] = 1936, [712] = 48, [724] = 2304, [726] = 3376, [728] = 2464, [730] = 64, [732] = 126, [746] = 1520, [748] = 2272, [750] = 3792, [752] = 2464, [1018] = 496, [754] = 2432, [756] = 96, [758] = 32, [760] = 1424, [762] = 2448, [764] = 2432, [766] = 32, [806] = 2672, [808] = 1728, [810] = 112, [812] = 1440, [814] = 784, [816] = 64, [818] = 288, [820] = 2672, [822] = 112, [824] = 2304, [826] = 3376, [828] = 640, [830] = 128, [832] = 2096, [834] = 2288, [836] = 48, [838] = 2768, [840] = 432, [842] = 48, [844] = 3808, [854] = 1856, [856] = 2832, [858] = 142, [860] = 2800, [862] = 1120, [864] = 2448, [866] = 158, [868] = 2672, [870] = 2784, [872] = 174, [874] = 64, [876] = 656, [878] = 16, [894] = 2464, [896] = 64, [898] = 2128, [902] = 48, [904] = 2976, [906] = 190, [908] = 96, [910] = 560, [912] = 3760, [914] = 3808, [916] = 144, [918] = 2464, [920] = 1968, [922] = 2272, [924] = 2016, [926] = 944, [928] = 2672, [930] = 2448, [932] = 2672, [934] = 16, [936] = 1072, [938] = 3648, [940] = 2880, [942] = 1472, [944] = 2816, [946] = 2864, [948] = 48, [950] = 206, [952] = 16, [954] = 222}
chests_written = false

function randomize_chests()
    chest_table_address = {0x529A60, 0x528D60}
    for offset,chest_short in pairs(chests) do
        WriteShort(chest_table_address[game_version] + offset, chest_short)
    end
end

function _OnInit()
    IsEpicGLVersion  = 0x3A2B86
    IsSteamGLVersion = 0x3A29A6
    if GAME_ID == 0xAF71841E and ENGINE_TYPE == "BACKEND" then
        if ReadByte(IsEpicGLVersion) == 0xF0 then
            ConsolePrint("Epic Version Detected")
            game_version = 1
            canExecute = true
        end
        if ReadByte(IsSteamGLVersion) == 0xF0 then
            ConsolePrint("Steam Version Detected")
            game_version = 2
            canExecute = true
        end
    end
end

function _OnFrame()
    if canExecute then
        if chests[0] ~= nil and not chests_written then
            randomize_chests()
        end
    end
end