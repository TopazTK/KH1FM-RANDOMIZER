-------------------------------------------
------ Kingdom Hearts 1 FM Randomizer -----
------              by Gicu           -----
-------------------------------------------

LUAGUI_NAME = "1fmRandoChests"
LUAGUI_AUTH = "Gicu"
LUAGUI_DESC = "Kingdom Hearts 1FM Randomizer Chests"

canExecute = false
chests = {[0] = 16, [40] = 2848, [42] = 48, [44] = 2304, [46] = 62, [48] = 800, [50] = 3376, [52] = 2032, [54] = 3376, [58] = 2464, [60] = 2672, [62] = 64, [64] = 2448, [66] = 944, [68] = 2816, [70] = 2304, [72] = 1920, [80] = 2672, [176] = 2672, [178] = 64, [180] = 16, [182] = 2672, [184] = 2304, [186] = 1616, [188] = 16, [190] = 3632, [192] = 48, [200] = 2448, [202] = 3376, [204] = 32, [206] = 864, [208] = 78, [210] = 96, [212] = 3056, [214] = 2272, [216] = 2432, [220] = 2864, [222] = 480, [224] = 640, [226] = 3808, [228] = 2816, [244] = 784, [246] = 3728, [248] = 128, [250] = 2896, [252] = 1776, [256] = 128, [258] = 94, [260] = 2672, [264] = 2672, [266] = 2432, [268] = 110, [270] = 3808, [272] = 3376, [274] = 1568, [276] = 32, [278] = 2288, [280] = 2464, [282] = 1968, [284] = 2272, [334] = 2720, [336] = 2672, [338] = 126, [340] = 2304, [394] = 112, [396] = 2848, [398] = 16, [400] = 1024, [402] = 2272, [404] = 1856, [406] = 384, [408] = 2816, [410] = 48, [412] = 144, [414] = 2672, [416] = 624, [418] = 2448, [420] = 142, [422] = 2272, [424] = 2656, [426] = 2000, [428] = 2128, [430] = 3664, [432] = 3472, [434] = 400, [436] = 16, [438] = 2464, [440] = 48, [442] = 2304, [444] = 2112, [446] = 112, [448] = 2288, [450] = 128, [452] = 2672, [454] = 2432, [456] = 158, [458] = 2672, [460] = 2864, [462] = 32, [464] = 2272, [466] = 2464, [606] = 2288, [608] = 1056, [610] = 2432, [612] = 1808, [614] = 112, [616] = 2432, [618] = 2576, [620] = 1520, [622] = 174, [624] = 16, [626] = 2464, [628] = 190, [630] = 576, [632] = 2448, [634] = 112, [656] = 1632, [658] = 2672, [660] = 2304, [662] = 112, [666] = 32, [668] = 2304, [670] = 2272, [672] = 144, [674] = 2672, [676] = 1104, [484] = 3040, [486] = 2464, [488] = 3008, [490] = 2880, [694] = 2464, [696] = 2544, [698] = 2288, [700] = 2672, [702] = 1728, [710] = 2448, [712] = 1088, [724] = 352, [726] = 688, [728] = 2672, [730] = 3696, [732] = 2448, [746] = 2272, [748] = 2384, [750] = 64, [752] = 206, [1018] = 2672, [754] = 2672, [756] = 1936, [758] = 2672, [760] = 2672, [762] = 3024, [764] = 1552, [766] = 222, [806] = 622, [808] = 544, [810] = 2288, [812] = 2672, [814] = 1744, [816] = 48, [818] = 638, [820] = 2288, [822] = 96, [824] = 2448, [826] = 112, [828] = 2272, [830] = 3808, [832] = 1696, [834] = 336, [836] = 2784, [838] = 288, [840] = 3808, [842] = 2672, [844] = 528, [854] = 1440, [856] = 4080, [858] = 2464, [860] = 512, [862] = 2448, [864] = 2272, [866] = 1008, [868] = 3808, [870] = 2832, [872] = 48, [874] = 112, [876] = 2672, [878] = 2864, [894] = 1984, [896] = 64, [898] = 496, [902] = 96, [904] = 2896, [906] = 144, [908] = 48, [910] = 768, [912] = 416, [914] = 1072, [916] = 1376, [918] = 3376, [920] = 2672, [922] = 3744, [924] = 64, [926] = 144, [928] = 1136, [930] = 654, [932] = 1584, [934] = 1872, [936] = 128, [938] = 368, [940] = 608, [942] = 64, [944] = 3808, [946] = 64, [948] = 112, [950] = 1680, [952] = 16, [954] = 16}
chests_written = false

function randomize_chests()
    chest_table_address = {0x529A60, 0x528D60}
    for offset,chest_short in pairs(chests) do
        WriteShort(chest_table_address[game_version] + offset, chest_short)
    end
end

function _OnInit()
    IsEpicGLVersion  = 0x3A2B86
    IsSteamGLVersion = 0x3A29A6
    if GAME_ID == 0xAF71841E and ENGINE_TYPE == "BACKEND" then
        if ReadByte(IsEpicGLVersion) == 0xF0 then
            ConsolePrint("Epic Version Detected")
            game_version = 1
            canExecute = true
        end
        if ReadByte(IsSteamGLVersion) == 0xF0 then
            ConsolePrint("Steam Version Detected")
            game_version = 2
            canExecute = true
        end
    end
end

function _OnFrame()
    if canExecute then
        if chests[0] ~= nil and not chests_written then
            randomize_chests()
        end
    end
end