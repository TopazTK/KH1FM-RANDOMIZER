-------------------------------------------
------ Kingdom Hearts 1 FM Randomizer -----
------              by Gicu           -----
-------------------------------------------

LUAGUI_NAME = "1fmRandoChests"
LUAGUI_AUTH = "Gicu"
LUAGUI_DESC = "Kingdom Hearts 1FM Randomizer Chests"

canExecute = false
chests = {[0] = 16, [40] = 2304, [42] = 144, [44] = 64, [46] = 576, [48] = 3744, [50] = 1536, [52] = 2736, [54] = 48, [58] = 2432, [60] = 3376, [62] = 128, [64] = 3376, [66] = 144, [68] = 3376, [70] = 2272, [72] = 128, [80] = 2672, [176] = 384, [178] = 2448, [180] = 2672, [182] = 64, [184] = 1984, [186] = 2976, [188] = 16, [190] = 16, [192] = 2672, [200] = 1568, [202] = 832, [204] = 16, [206] = 1008, [208] = 1584, [210] = 48, [212] = 528, [214] = 3024, [216] = 16, [220] = 3648, [222] = 2016, [224] = 1840, [226] = 32, [228] = 32, [244] = 1856, [246] = 1376, [248] = 672, [250] = 48, [252] = 2048, [256] = 2832, [258] = 800, [260] = 2272, [264] = 62, [266] = 48, [268] = 3808, [270] = 128, [272] = 2448, [274] = 1520, [276] = 2288, [278] = 288, [280] = 2448, [282] = 2848, [284] = 2432, [334] = 1136, [336] = 78, [338] = 2528, [340] = 3808, [394] = 2672, [396] = 32, [398] = 128, [400] = 2640, [402] = 2672, [404] = 2432, [406] = 2768, [408] = 2896, [410] = 1824, [412] = 2128, [414] = 2672, [416] = 112, [418] = 94, [420] = 608, [422] = 3808, [424] = 112, [426] = 2304, [428] = 2432, [430] = 110, [432] = 560, [434] = 2400, [436] = 2464, [438] = 96, [440] = 864, [442] = 544, [444] = 752, [446] = 2848, [448] = 2288, [450] = 2576, [452] = 336, [454] = 3376, [456] = 448, [458] = 2672, [460] = 128, [462] = 2432, [464] = 2448, [466] = 3472, [606] = 3808, [608] = 2272, [610] = 32, [612] = 736, [614] = 126, [616] = 144, [618] = 1360, [620] = 2432, [622] = 2272, [624] = 128, [626] = 142, [628] = 64, [630] = 2464, [632] = 784, [634] = 2304, [656] = 3792, [658] = 2880, [660] = 2672, [662] = 16, [666] = 2288, [668] = 2464, [670] = 2816, [672] = 2672, [674] = 158, [676] = 1024, [484] = 1616, [486] = 16, [488] = 2304, [490] = 3376, [694] = 2272, [696] = 2272, [698] = 2304, [700] = 16, [702] = 2272, [710] = 2672, [712] = 96, [724] = 128, [726] = 1632, [728] = 112, [730] = 3376, [732] = 704, [746] = 96, [748] = 816, [750] = 496, [752] = 174, [1018] = 96, [754] = 128, [756] = 2096, [758] = 2672, [760] = 3568, [762] = 2752, [764] = 2864, [766] = 3696, [806] = 190, [808] = 1680, [810] = 2672, [812] = 2288, [814] = 128, [816] = 3760, [818] = 3808, [820] = 2672, [822] = 2672, [824] = 206, [826] = 2864, [828] = 96, [830] = 2464, [832] = 3728, [834] = 2816, [836] = 3808, [838] = 64, [840] = 2464, [842] = 112, [844] = 1872, [854] = 222, [856] = 2304, [858] = 2592, [860] = 2848, [862] = 2560, [864] = 1104, [866] = 352, [868] = 2304, [870] = 112, [872] = 2656, [874] = 2896, [876] = 2432, [878] = 464, [894] = 2544, [896] = 2432, [898] = 1456, [902] = 32, [904] = 976, [906] = 32, [908] = 128, [910] = 2672, [912] = 1696, [914] = 3776, [916] = 2432, [918] = 96, [920] = 1936, [922] = 1408, [924] = 622, [926] = 992, [928] = 1072, [930] = 3808, [932] = 1744, [934] = 112, [936] = 48, [938] = 2288, [940] = 128, [942] = 64, [944] = 2448, [946] = 768, [948] = 32, [950] = 3808, [952] = 16, [954] = 32}
chests_written = false

function randomize_chests()
    chest_table_address = {0x529A60, 0x528D60}
    for offset,chest_short in pairs(chests) do
        WriteShort(chest_table_address[game_version] + offset, chest_short)
    end
end

function _OnInit()
    IsEpicGLVersion  = 0x3A2B86
    IsSteamGLVersion = 0x3A29A6
    if GAME_ID == 0xAF71841E and ENGINE_TYPE == "BACKEND" then
        if ReadByte(IsEpicGLVersion) == 0xF0 then
            ConsolePrint("Epic Version Detected")
            game_version = 1
            canExecute = true
        end
        if ReadByte(IsSteamGLVersion) == 0xF0 then
            ConsolePrint("Steam Version Detected")
            game_version = 2
            canExecute = true
        end
    end
end

function _OnFrame()
    if canExecute then
        if chests[0] ~= nil and not chests_written then
            randomize_chests()
        end
    end
end