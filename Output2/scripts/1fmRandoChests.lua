-------------------------------------------
------ Kingdom Hearts 1 FM Randomizer -----
------              by Gicu           -----
-------------------------------------------

LUAGUI_NAME = "1fmRandoChests"
LUAGUI_AUTH = "Gicu"
LUAGUI_DESC = "Kingdom Hearts 1FM Randomizer Chests"

canExecute = false
chests = {[0] = 16, [40] = 960, [42] = 112, [44] = 3376, [46] = 480, [48] = 128, [50] = 62, [52] = 2384, [54] = 352, [58] = 944, [60] = 112, [62] = 2944, [64] = 1408, [66] = 96, [68] = 78, [70] = 94, [72] = 1840, [80] = 96, [176] = 2832, [178] = 736, [180] = 48, [182] = 110, [184] = 2672, [186] = 1536, [188] = 320, [190] = 512, [192] = 126, [200] = 1504, [202] = 16, [204] = 1552, [206] = 2976, [208] = 2864, [210] = 2688, [212] = 2848, [214] = 752, [216] = 2976, [220] = 2496, [222] = 32, [224] = 2672, [226] = 1728, [228] = 142, [244] = 158, [246] = 174, [248] = 3808, [250] = 1088, [252] = 2672, [256] = 128, [258] = 288, [260] = 190, [264] = 112, [266] = 2672, [268] = 576, [270] = 3376, [272] = 64, [274] = 206, [276] = 2800, [278] = 1872, [280] = 1808, [282] = 222, [284] = 2640, [334] = 16, [336] = 16, [338] = 16, [340] = 16, [394] = 2976, [396] = 622, [398] = 638, [400] = 654, [402] = 720, [404] = 2272, [406] = 848, [408] = 2896, [410] = 2464, [412] = 3376, [414] = 112, [416] = 2432, [418] = 96, [420] = 2048, [422] = 670, [424] = 2672, [426] = 1664, [428] = 2672, [430] = 2080, [432] = 48, [434] = 2448, [436] = 48, [438] = 2672, [440] = 798, [442] = 432, [444] = 814, [446] = 1488, [448] = 2288, [450] = 400, [452] = 2288, [454] = 2272, [456] = 896, [458] = 830, [460] = 3376, [462] = 1632, [464] = 2304, [466] = 448, [606] = 3376, [608] = 1776, [610] = 1022, [612] = 1038, [614] = 96, [616] = 2800, [618] = 96, [620] = 800, [622] = 1054, [624] = 1070, [626] = 2464, [628] = 1086, [630] = 2816, [632] = 48, [634] = 128, [656] = 1040, [658] = 368, [660] = 2288, [662] = 1102, [666] = 3648, [668] = 1424, [670] = 2880, [672] = 2672, [674] = 1696, [676] = 3760, [484] = 2800, [486] = 1456, [488] = 1118, [490] = 2976, [694] = 2672, [696] = 2928, [698] = 1520, [700] = 1134, [702] = 2672, [710] = 1616, [712] = 2304, [724] = 496, [726] = 1104, [728] = 64, [730] = 128, [732] = 1150, [746] = 2672, [748] = 2768, [750] = 1166, [752] = 2432, [1018] = 2832, [754] = 1376, [756] = 2672, [758] = 2832, [760] = 2896, [762] = 2880, [764] = 464, [766] = 3376, [806] = 2272, [808] = 2016, [810] = 2976, [812] = 1120, [814] = 2672, [816] = 2128, [818] = 3376, [820] = 2576, [822] = 2864, [824] = 528, [826] = 112, [828] = 1182, [830] = 1198, [832] = 2272, [834] = 3696, [836] = 1214, [838] = 2272, [840] = 16, [842] = 704, [844] = 2672, [854] = 2000, [856] = 112, [858] = 1072, [860] = 2464, [862] = 3776, [864] = 2432, [866] = 112, [868] = 1230, [870] = 16, [872] = 688, [874] = 1246, [876] = 3376, [878] = 784, [894] = 2672, [896] = 2672, [898] = 3808, [902] = 2672, [904] = 128, [906] = 2480, [908] = 624, [910] = 1262, [912] = 2672, [914] = 1952, [916] = 880, [918] = 1278, [920] = 128, [922] = 1824, [924] = 2592, [926] = 2672, [928] = 2672, [930] = 1712, [932] = 16, [934] = 2752, [936] = 2672, [938] = 128, [940] = 1294, [942] = 2864, [944] = 336, [946] = 1856, [948] = 2304, [950] = 1760, [952] = 16, [954] = 2720}
chests_written = false

function randomize_chests()
    chest_table_address = {0x529A60, 0x528D60}
    for offset,chest_short in pairs(chests) do
        WriteShort(chest_table_address[game_version] + offset, chest_short)
    end
end

function _OnInit()
    IsEpicGLVersion  = 0x3A2B86
    IsSteamGLVersion = 0x3A29A6
    if GAME_ID == 0xAF71841E and ENGINE_TYPE == "BACKEND" then
        if ReadByte(IsEpicGLVersion) == 0xF0 then
            ConsolePrint("Epic Version Detected")
            game_version = 1
            canExecute = true
        end
        if ReadByte(IsSteamGLVersion) == 0xF0 then
            ConsolePrint("Steam Version Detected")
            game_version = 2
            canExecute = true
        end
    end
end

function _OnFrame()
    if canExecute then
        if chests[0] ~= nil and not chests_written then
            randomize_chests()
        end
    end
end